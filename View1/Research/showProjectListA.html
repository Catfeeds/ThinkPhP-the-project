<!DOCTYPE html>
<html>


<!-- Mirrored from www.zi-han.net/theme/hplus/table_data_tables.html by HTTrack Website Copier/3.x [XR&CO'2014], Wed, 20 Jan 2016 14:20:01 GMT -->
<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <title>项目列表-数据表格</title>
    <link href="__PUBLIC__/html/css/bootstrap.min14ed.css?v=3.3.6" rel="stylesheet">
    <link href="__PUBLIC__/html/css/font-awesome.min93e3.css?v=4.4.0" rel="stylesheet">

    <!-- Data Tables -->
    <link href="__PUBLIC__/html/css/plugins/dataTables/dataTables.bootstrap.css" rel="stylesheet">

    <link href="__PUBLIC__/html/css/animate.min.css" rel="stylesheet">
    <link href="__PUBLIC__/html/css/style.min862f.css?v=4.1.0" rel="stylesheet">
    <style type="text/css">
        body {
            color: black;
        }
    </style>
</head>

<body class="gray-bg"<div>    <button type="button" class="btn btn-default refresh-btn" aria-label="Left Align">        <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span>    </button></div>
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-sm-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>项目列表</h5>
                    <div class="fa-hover col-md-2 col-sm-6 "><a href="__CONTROLLER__/addProject"><i class="fa fa-plus"></i> 新项目</a></div>
                    <div class="fa-hover col-md-2 col-sm-6 "><a href="javascript:;" class="prj-list"><i class="fa fa-tv">项目首页</i></a></div>
                    <div class="fa-hover col-md-2 col-sm-6 "><a href="javascript:;" class="prj-24"><i class="fa fa-tv">今日项目进展</i></a></div>
                    <div class="fa-hover col-md-2 col-sm-6 "><a href="javascript:;" class="prj-7"><i class="fa fa-tv">近七日项目进展</i></a></div>
                    <div class="ibox-tools"><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></div>
                </div>
                <div class="ibox-content">
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>编号</th>
                            <th>名称</th>
                            <th>关键字</th>
                            <th>立项人</th>
                            <th>责任人</th>
                            <th>参与人</th>
                            <th>研发费</th>
                            <th>总绩效</th>
                            <th>距截止</th>
                            <th>项目状态</th>
                            <th>进度记录</th>
                            <th>变更记录</th>
                            <th>操作选项</th>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name="idPrj" id="vol">
                            <tr class="gradeX">
                                <td><a href="javascript:;" class="prjDetail" data={$vol.proid}>{$vol.proid}</a></td>
                                <td>{$vol.proname}</td>
                                <td>{$vol.keyword}</td>
                                <td class="center">{$vol.buildname}</td>
                                <td>{$vol.responname}</td>
                                <td><a href="javascript:;" class="performOfPrj" data={$vol.proid}>{$vol.pname}</a></td>

                                <td><a href="javascript:;" class="performOfPrj" data={$vol.proid}>{$vol.proprice}</a></td>
                                <td><a href="javascript:;" class="performOfPrj" data={$vol.proid}>{$vol.performbonus}</a></td>
                                <td class="setTime" data="{$vol.deliverytime}"></td>
                                <td class="center">
                                    <switch name="vol.prostatus">
                                        <case value="1">需求分析</case>
                                        <case value="2">在做</case>
                                        <case value="3">完成</case>
                                        <case value="4">验收</case>
                                        <case value="5">失败</case>
                                    </switch>
                                </td>
                                <td class="center"><a class="updLayer" href="javascript:;" data="{$vol.proid}" >{$vol.num}</a></td>
                                <td class="center"><a class="changeLayer" href="javascript:;" data="{$vol.proid}" >{$vol.cnum}</a></td>
                                <td class="center"><a class="updatePrj" data="{$vol.proid}" href="javascript:;">更新</a>||<a href="javascript:;" class="changePrj" data="{$vol.proid}" >变更</a></td>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <table class="table table-striped table-bordered table-hover dataTables-example">
                        <thead>
                        <tr>
                            <th>编号</th>
                            <th>名称</th>
                            <th>关键字</th>
                            <th>部门</th>
                            <th>立项人</th>
                            <th>责任人</th>
                            <th>参与人</th>
                            <th>研发费</th>
                            <th>总绩效</th>
                            <th>起止日期</th>
                            <th>审核状态</th>
                            <th>操作选项</th>
                        </tr>
                        </thead>
                        <tbody>
                        <volist name="audit" id="vol">
                            <tr class="gradeX">
                                <td><a href="javascript:;" class="prjDetail" data={$vol.proid}>{$vol.proid}</a></td>
                                <td>{$vol.proname}</td>
                                <td>{$vol.keyword}</td>
                                <td class="center">
                                    {$vol.deptname}
                                </td>
                                <td>{$vol.buildname}</td>
                                <td>{$vol.responname}</td>
                                <td><a href="javascript:;" class="performOfPrj" data={$vol.proid}>{$vol.pname}</a></td>
                                <td><a href="javascript:;" class="performOfPrj" data={$vol.proid}>{$vol.proprice}</a></td>
                                <td><a href="javascript:;" class="performOfPrj" data={$vol.proid}>{$vol.performbonus}</a></td>
                                <td>{$vol.protime|date='Y-m-d',###}——{$vol.deliverytime|date='Y-m-d',###}</td>
                                <td class="center">
                                    <switch name="vol.auditstatus">
                                        <case value="1">{$vol.auditname}未审</case>
                                        <case value="2">总经理未审</case>
                                        <case value="4">审核不通过</case>
                                    </switch>
                                </td>
                                <td class="center">
                                    <input type="checkbox" name="resCheckBox" class="checkValue" data="{$vol.auditorid}" value="{$vol.proid}" >
                                </td>
                            </tr>
                        </volist>
                        </tbody>
                    </table>
                    <input class="btn btn-outline btn-success" type="button" id="checkProject" value="项目审核" onclick="jqchk2();" style="width: 10%; text-align: center;">
                    <input class="hidden" type="hidden" id="rolestaff" value="{$Think.session.staffId}">
                </div>
            </div>
        </div>
    </div>
</div>

<script src="__PUBLIC__/html/js/jquery-1.11.3.min.js"></script>
<script src="__PUBLIC__/html/js/bootstrap.min.js?v=3.3.6"></script>
<script src="__PUBLIC__/html/js/plugins/jeditable/jquery.jeditable.js"></script>
<script src="__PUBLIC__/html/js/plugins/dataTables/jquery.dataTables.js"></script>
<script src="__PUBLIC__/html/js/plugins/dataTables/dataTables.bootstrap.js"></script>
<script src="__PUBLIC__/html/js/content.min.js?v=1.0.0"></script>
<script src="__PUBLIC__/html/js/plugins/layer/layer.js"></script>
<script>
    $(document).ready(function(){
        $(".dataTables-example").dataTable();
    });

    /*********************js显示截至时间*********************************/
    var now = Date.parse(new Date()).toString();
    now = now.substr(0, 10);
    var jiezhi = [];
    var ch = [];
    $(".setTime").each(function(i) {
        jiezhi[i] = $(this).attr('data');
        ch[i] = (jiezhi[i] - now)/3600/24;
        ch[i] = ch[i].toFixed(0);
        if (ch[i] >= 0) {
            $(this).text("还剩" + ch[i] + "天");
        } else {
            ch[i] = -1 * ch[i];
            $(this).text("超时" + ch[i] + "天");
        }
    });
    /*********************************end************************************/


    /*********************点击变更，更新项目*********************************/
    $('.prjDetail').on('click', function() {
        var prjid = $(this).attr('data');
        window.location.href = "__CONTROLLER__/showProjectDetail/id/" + prjid;
    });
    $('.changePrj').on('click', function() {
        var prjid = $(this).attr('data');
        window.location.href = "__CONTROLLER__/changeProject/prjid/" + prjid;
    });
    /*********************************end***************************************/


    /*********************layer层查看进度和变更*********************************/
    $(".performOfPrj").on('click', function() {
        var prjid = $(this).attr('data');

        layer.open({
            type: 2,
            title: '项目绩效',
            area: ['90%', '63%'],
            content: "__CONTROLLER__/showPerformanceDetail/id/" + prjid //iframe的url
        });
    });
    $(".updatePrj").on('click', function() {
        var prjid = $(this).attr('data');
        layer.open({
            type: 2,
            title: '项目进度更新',
            area: ['90%', '80%'],
            content: "__CONTROLLER__/updateProject/id/" + prjid //iframe的url
        });
    });
    $(".updLayer").on('click',function() {
        var module = $(this).attr("data");
        layer.open({
            type: 2,
            title: '项目进度',
            area: ['90%', '90%'],
            content: "__CONTROLLER__/showPrjUpdateList/m/" + module //iframe的url
        });
    });
    $(".changeLayer").on('click',function() {
        var prjids = $(this).attr("data");
        layer.open({
            type: 2,
            title: '项目变更记录',
            area: ['90%', '90%'],
            content: "__CONTROLLER__/showPrjChangeList/m/" + prjids //iframe的url
        });
    });
    /*********************************end********************************************/


    /*********************项目24小时，7日内的记录数*********************************/
    $(".prj-list").on('click', function() {
        window.location.href = "__CONTROLLER__/showProjectList";
    });
    $(".prj-24").on('click', function() {
        window.location.href = "__CONTROLLER__/showPrjUpdateDay/k/1";
    });
    $(".prj-7").on('click', function() {
        window.location.href = "__CONTROLLER__/showPrjUpdateDay/k/7";
    });
    /*********************************end********************************************/


    /***********************************按钮审核记录***********************************/
    var controller = "__CONTROLLER__";
    var chk_value = [], chk_data = [];
    function jqchk2()
    {
        chk_value = [];
        chk_data = [];
        $('input[name="resCheckBox"]:checked').each(function() {
            chk_value.push($(this).val());
            chk_data.push($(this).attr('data'));
        });
    }
    $("#checkProject").on('click', function() {
        if ($("input:checkbox[name='resCheckBox']").is(':checked')) {
            //id : 登录人 auid：审核人 pid 项目id
            var id = $("#rolestaff").val();
            var auid = chk_data[0];
            var pid = chk_value[0];
            $.ajax({
                type : 'POST',
                url : controller + '/checkRole',
                data : {userId : id},
                success : function (msg) {
                    if (msg['status'] != 8) {
                        if (id != auid) {
                            layer.alert('您不是审核人',{icon : 3});
                            return false;
                        } else {
                            layer.confirm('审核选项',
                                {
                                    btn : ['有效','无效']
                                }, function() {
                                    $.ajax({
                                        type : 'POST',
                                        url  : controller + '/checkProject',
                                        data : {
                                            proid : chk_value[0],
                                            auid  : auid,
                                            k     : 2
                                        },
                                        success : function(data) {
                                            if (data == 2) {
                                                layer.msg('操作成功', {icon: 6,time:2000});
                                                window.location.reload();
                                            } else {
                                                layer.msg('好像出错了', {icon: 5,time:2000});
                                                window.location.reload();
                                            }
                                        }
                                    });
                                }, function() {
                                    $.ajax({
                                        type : 'POST',
                                        url  : controller + '/checkProject',
                                        data : {
                                            proid : chk_value[0],
                                            auid  : auid,
                                            k     : 1
                                        },
                                        success : function(data) {
                                            if (data == 2) {
                                                layer.msg('操作成功', {icon: 6,time:2000});
                                                window.location.reload();
                                            } else {
                                                layer.msg('好像出错了', {icon: 5,time:2000});
                                                window.location.reload();
                                            }
                                        }
                                    });
                                });
                        }
                    } else {
                        layer.confirm('超管审核选项',
                            {
                                btn : ['有效','无效']
                            }, function() {
                                $.ajax({
                                    type : 'POST',
                                    url  : controller + '/checkProject',
                                    data : {
                                        proid : chk_value[0],
                                        auid  : auid,
                                        k     : 3
                                    },
                                    success : function(data) {
                                        if (data == 2) {
                                            layer.msg('操作成功', {icon: 6,time:2000});
                                            window.location.reload();
                                        } else {
                                            layer.msg('好像出错了', {icon: 5,time:2000});
                                            window.location.reload();
                                        }
                                    }
                                });
                            }, function() {
                                $.ajax({
                                    type : 'POST',
                                    url  : controller + '/checkProject',
                                    data : {
                                        proid : chk_value[0],
                                        auid  : auid,
                                        k     : 1
                                    },
                                    success : function(data) {
                                        if (data == 2) {
                                            layer.msg('操作成功', {icon: 6,time:2000});
                                            window.location.reload();
                                        } else {
                                            layer.msg('好像出错了', {icon: 5,time:2000});
                                            window.location.reload();
                                        }
                                    }
                                });
                            });
                    }
                }
            });

        } else {
            layer.alert('请选中要审核的项目');
        }
    });
    /*********************************end********************************************/
</script>
</body>
</html>
